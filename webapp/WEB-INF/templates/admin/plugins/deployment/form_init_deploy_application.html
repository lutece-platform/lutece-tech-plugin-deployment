<script src="js/plugins/deployment/selectbox.js" type="text/javascript"></script>
<script src="js/plugins/deployment/deployment.js" type="text/javascript"></script>

<div class="row" >

    <legend>#i18n{deployment.form_init_deploy_application.table_label}</legend>

	<#if error_message?has_content>
		${error_message}
		<a class="btn btn-primary btn-xs" href="jsp/admin/user/ModifyUser.jsp?id_user=${id_user}"  title="#i18n{deployment.create_application.action_modify_user_account}" >
         	<i class="glyphicon glyphicon-editclass="glyphicon glyphicon-"></i> 
        </a>
	<#else>
		<script type="text/javascript">
		
		<#if deploy_war>
			// empty component list and unselect category
			initComponantsEnvironment();
			var itemsMapServerTomcat = new Object();
			<#list server_instance_map_tomcat?keys as environment_key>
				var itemList = new Array();
				<#assign listServerApplicationInstance = server_instance_map_tomcat[environment_key!]! /> 
				<#list listServerApplicationInstance as serverApplicationInstance>
					var item = new Object();
					item["code"] = "${serverApplicationInstance.code}";
					item["name"] = "${serverApplicationInstance.name}";
					itemList.push(item);
				</#list>
				itemsMapServerTomcat["${environment_key}"] = itemList;
			</#list>
			
	</#if>
	 <#if deploy_sql>
		var itemsMapServerMysql = new Object();
		<#list server_instance_map_mysql?keys as environment_key>
			var itemList = new Array();
			<#assign listServerApplicationInstance = server_instance_map_mysql[environment_key!]! /> 
			<#list listServerApplicationInstance as serverApplicationInstance>
				var item = new Object();
				item["code"] = "${serverApplicationInstance.code}";
				item["name"] = "${serverApplicationInstance.name}";
				itemList.push(item);
			</#list>
			itemsMapServerMysql["${environment_key}"] = itemList;
		</#list>
		
		var itemsMapDatabase = new Object();
		<#list database_map?keys as database_environment_key>
			var itemList = new Array();
			<#assign listDatabase = database_map[database_environment_key!]! /> 
			<#list listDatabase as database>
				var item = new Object();
				item["code"] = "${database}";
				item["name"] = "${database}";
				itemList.push(item);
			</#list>
			itemsMapDatabase["${database_environment_key}"] = itemList;
		</#list>
	 </#if>
		
		</script>
		<form class="form-horizontal" method="post" name="form_init_deploy_application" id="form_init_deploy_application" action="jsp/admin/plugins/deployment/DoDeployApplication.jsp" enctype="multipart/form-data">
	        <input id="id_application" name="id_application" type="hidden" value="${application.idApplication}">
	        <input type="hidden" id="plugin_name" name="plugin_name" value="deployment">
	        <fieldset>
	            <div class="form-group">
	                <label class="control-label col-xs-12 col-sm-3 col-md-3" for="code_environment" >#i18n{deployment.form_init_deploy_application.label_code_environment}*:</label>
	                <div class="col-xs-12 col-sm-9 col-md-9">
	                    <#if deploy_war>
	                   	 <@comboWithParams name="code_environment" default_value="all" items=environment_list additionalParameters="onchange='refreshComponantsTomcat();' class='form-control input-sm'" />
	          			
	          			<#else>
	          			  <@comboWithParams name="code_environment" default_value="all" items=environment_list additionalParameters="onchange='refreshComponantsMysql();' class='form-control input-sm'" />
	          			
	          			</#if>
	          			
	          		</div>
	            </div>
	            <#if deploy_war>
	            	<input type="hidden" id="deploy_war" name="deploy_war" value="deploy_war" />
	           </#if>
	            <#if deploy_sql>
	            	  <input type="hidden" id="deploy_sql" name="deploy_sql" value="deploy_sql" />
	            </#if>  
	           
	             
	           <#if deploy_war>
	            <div class="form-group">
	                <label class="control-label col-xs-12 col-sm-3 col-md-3" for="code_server_application_instance_tomcat" >#i18n{deployment.form_init_deploy_application.label_code_server_application_instance_tomcat}*:</label>
	                <div class="col-xs-12 col-sm-9 col-md-9">
	                 <select name="code_server_application_instance_tomcat" id="code_server_application_instance_tomcat" class="form-control input-sm">
	                 </select>
	                   		
	                </div>
	            </div>
	             
	          	<div class="form-group">
	                <label class="control-label col-xs-12 col-sm-3 col-md-3" for="tag_before_deploy" >#i18n{deployment.form_init_deploy_application.label_tag_before_deploy}:</label>
	                <div class="col-xs-12 col-sm-9 col-md-9">
						<div class="checkbox">
							<label>
							<input type="checkbox" id="tag_site_before_deploy" name="tag_site_before_deploy">&nbsp;
							</label>
						</div>
	                </div>
	            </div>
	            
	            <div class="form-group">
	                <label class="control-label col-xs-12 col-sm-3 col-md-3" for="tag_to_deploy" >#i18n{deployment.form_init_deploy_application.label_tag_to_deploy}*:</label>
	                <div class="col-xs-12 col-sm-9 col-md-9">
	                    <@comboWithParams name="tag_to_deploy" default_value="all" items=site_list additionalParameters="onchange='' class='form-control input-sm'" />
	          		</div>
	            </div>
	            
	            </#if>
	             <#if deploy_sql>
		             <div class="form-group">
		            	<label class="control-label col-xs-12 col-sm-3 col-md-3" for="code_server_application_instance_mysql" >#i18n{deployment.form_init_deploy_application.label_code_server_application_instance_mysql}*:</label>
		                <div class="col-xs-12 col-sm-9 col-md-9">
		                 <select name="code_server_application_instance_mysql" id="code_server_application_instance_mysql" onchange="refreshComponantsDatabase();"> 
		                 </select>
		                 </div>
		            </div>
		             <div class="form-group">
		            	<label class="control-label col-xs-12 col-sm-3 col-md-3" for="code_database" >#i18n{deployment.form_init_deploy_application.label_code_database}*:</label>
		                <div class="col-xs-12 col-sm-9 col-md-9">
		                 <select name="code_database" id="code_database" > 
		                 </select>
		                 </div>
		            </div>
		              <div class="form-group">
			                <label class="control-label col-xs-12 col-sm-3 col-md-3" for="name" >#i18n{deployment.form_init_deploy_application.label_select_upgrade_script}  : </label> 
			                <div class="col-xs-12 col-sm-9 col-md-9">	
			                     <@combo name="script_upgrade_selected"  items=upgrade_file_list default_value="" />
			                </div>
	           		 </div>
		             <div class="form-group">
		            	<label class="control-label col-xs-12 col-sm-3 col-md-3" for="file_upload" >#i18n{deployment.form_init_deploy_application.label_script_upload}:</label>
		                <div class="col-xs-12 col-sm-9 col-md-9">
		                 	<input type="file" name="script_upload" id="script_upload"> 
		                </div>
		            </div>
		            
		         </#if>   
	            
	          
	            
	            <div class="form-group">
					<div class="col-xs-12 col-sm-offset-3 col-sm-9 col-md-offset-3 col-md-9">
						<button class="btn btn-primary btn-sm" type="submit" >#i18n{deployment.form_init_deploy_application.button_deploy}</button>
						<a class="btn btn-default btn-sm" href="jsp/admin/plugins/deployment/ManageApplication.jsp?plugin_name=deployment"" title="#i18n{portal.util.labelCancel}">#i18n{portal.util.labelCancel}</a>
					</div>
	            </div>
	
	        </fieldset>
	    </form>
	</#if>
</div>

<script>
$(document).ready(function(e){
	$("#tag_site_before_deploy").click( function(e){
		if ($(this).is (':checked'))
		{
			$("#tag_to_deploy").hide();
		}
		else
		{
			$("#tag_to_deploy").show();
		}	
			}
		);
 });
</script>
